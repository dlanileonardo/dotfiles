PROJECT( Flatabulous )
CMAKE_MINIMUM_REQUIRED( VERSION 2.8 )

SET( APP_VER_MAJOR 0 )
SET( APP_VER_MINOR 0 )
SET( APP_VER_PATCH 1 )
SET( APP_VERSION ${APP_VER_MAJOR}.${APP_VER_MINOR}.${APP_VER_PATCH} )

MESSAGE( "Building version: ${APP_VERSION}..." )

SET( CPACK_PACKAGE_VENDOR              "Anmol Jagetia")
SET( CPACK_PACKAGE_CONTACT             "anmoljagetia@gmail.com")
SET( CPACK_PACKAGE_DESCRIPTION         "Flatabulous flat theme")
SET( CPACK_PACKAGE_DESCRIPTION_SUMMARY "This is a Flat theme for Ubuntu and other debian based Linux Systems.")
SET( CPACK_PACKAGE_NAME                "flatabulous-theme")
SET( CPACK_PACKAGE_VERSION             ${APP_VERSION})
SET( CPACK_PACKAGE_VERSION_MAJOR       ${APP_VER_MAJOR})
SET( CPACK_PACKAGE_VERSION_MINOR       ${APP_VER_MINOR})
SET( CPACK_PACKAGE_VERSION_PATCH       ${APP_VER_PATCH})
SET( CPACK_DEBIAN_PACKAGE_SECTION      "x11")
SET( CPACK_SYSTEM_NAME                 "noarch" )
SET( CPACK_DEBIAN_PACKAGE_ARCHITECTURE "all" )
SET( CPACK_DEBIAN_PACKAGE_PRIORITY     "optional")
SET( CPACK_DEBIAN_PACKAGE_MAINTAINER   "Anmol Jagetia <anmoljagetia@gmail.com>")
SET( CPACK_DEBIAN_PACKAGE_DEPENDS      "")
SET( CPACK_GENERATOR                   "DEB")

INCLUDE( CPack )

SET( DESTINATION_DIR /usr/share/themes/Flatabulous )

INSTALL( FILES     ../CREDITS          DESTINATION ${DESTINATION_DIR} )
INSTALL( FILES     ../debian/copyright DESTINATION /usr/share/doc/${CPACK_PACKAGE_NAME} )
INSTALL( FILES     ../debian/changelog DESTINATION /usr/share/doc/${CPACK_PACKAGE_NAME} )
INSTALL( FILES     ../README.md        DESTINATION ${DESTINATION_DIR} )
INSTALL( FILES     ../index.theme      DESTINATION ${DESTINATION_DIR} )
INSTALL( DIRECTORY ../gtk-2.0          DESTINATION ${DESTINATION_DIR} )
INSTALL( DIRECTORY ../gtk-3.0          DESTINATION ${DESTINATION_DIR} )
INSTALL( DIRECTORY ../metacity-1       DESTINATION ${DESTINATION_DIR} )
INSTALL( DIRECTORY ../openbox-3        DESTINATION ${DESTINATION_DIR} )
INSTALL( DIRECTORY ../unity            DESTINATION ${DESTINATION_DIR} )
INSTALL( DIRECTORY ../xfce-notify-4.0  DESTINATION ${DESTINATION_DIR} )
INSTALL( DIRECTORY ../xfwm4            DESTINATION ${DESTINATION_DIR} )


# thx to: https://github.com/paralect/robomongo/blob/master/install/linux/fixup_deb.sh.in
IF (${CMAKE_VERSION} VERSION_LESS "3.3.2")
  SET( CPACK_PACKAGE_FILE_NAME ${CPACK_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION}-${CPACK_SYSTEM_NAME} )
  MESSAGE(STATUS "CMake verison ${CMAKE_VERSION} < 3.3.2 : Enabling deb-package target for ${CPACK_PACKAGE_FILE_NAME}.deb")
  
  ADD_CUSTOM_COMMAND(OUTPUT fix-debian
	COMMENT "Fixing ${CPACK_PACKAGE_FILE_NAME}..."
	COMMAND cpack WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND rm -rf fix_up_deb WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND mkdir fix_up_deb WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND dpkg-deb -x ${CPACK_PACKAGE_FILE_NAME}.deb fix_up_deb WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND dpkg-deb --control ${CPACK_PACKAGE_FILE_NAME}.deb fix_up_deb/DEBIAN WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND rm ${CPACK_PACKAGE_FILE_NAME}.deb WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND chmod 0644 fix_up_deb/DEBIAN/md5sums WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND find -type d -print0 |xargs -0 chmod 755 WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND fakeroot dpkg -b fix_up_deb ${CPACK_PACKAGE_FILE_NAME}.deb WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	COMMAND rm -rf fix_up_deb WORKING_DIRECTORY ${PROJECT_BINARY_DIR}
	)
  
  ADD_CUSTOM_TARGET(deb-package DEPENDS fix-debian)
ENDIF()
